<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Resampling (sinc Interpolation) · FourierTools.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FourierTools.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">FourierTools.jl</a></li><li><a class="tocitem" href="../helpers/">FFT Helpers</a></li><li><a class="tocitem" href="../convolutions/">FFT Based Convolutions and Cross-Correlation</a></li><li class="is-active"><a class="tocitem" href>Resampling (sinc Interpolation)</a><ul class="internal"><li><a class="tocitem" href="#Sinc-interpolation"><span>Sinc interpolation</span></a></li><li><a class="tocitem" href="#Downsampling"><span>Downsampling</span></a></li><li><a class="tocitem" href="#Image-Upsampling"><span>Image Upsampling</span></a></li><li><a class="tocitem" href="#Function-References"><span>Function References</span></a></li></ul></li><li><a class="tocitem" href="../shifting/">Shifting with FFTs</a></li><li><a class="tocitem" href="../shear/">Image Shearing with FFTs</a></li><li><a class="tocitem" href="../rotate/">Image Rotation with FFTs</a></li><li><a class="tocitem" href="../nfft/">NFFT</a></li><li><a class="tocitem" href="../czt/">CZT</a></li><li><a class="tocitem" href="../fractional/">Fractional Fourier Transform</a></li><li><a class="tocitem" href="../utils/">Utility Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Resampling (sinc Interpolation)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Resampling (sinc Interpolation)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bionanoimaging/FourierTools.jl/blob/main/docs/src/resampling.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Resampling"><a class="docs-heading-anchor" href="#Resampling">Resampling</a><a id="Resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Resampling" title="Permalink"></a></h1><p>To sinc interpolate a signal, it is possible to zero pad a signal in Fourier space and to do an inverse Fourier transform effectively evaluating the Fourier series at more samples. If the signal was initially band-limited, sinc interpolation leads to smoother, perfectly interpolated signals</p><h2 id="Sinc-interpolation"><a class="docs-heading-anchor" href="#Sinc-interpolation">Sinc interpolation</a><a id="Sinc-interpolation-1"></a><a class="docs-heading-anchor-permalink" href="#Sinc-interpolation" title="Permalink"></a></h2><p>Below you can find a simple example for up sampling using <code>resample</code>.  Furthermore, there is an image interpolation <a href="https://github.com/fonsp/Pluto.jl">Pluto.jl</a> notebook in the <a href="https://github.com/bionanoimaging/FourierTools.jl/tree/main/examples/">examples folder</a>. We can see that the interpolated signal matches the higher sampled signal well.</p><pre><code class="language-julia hljs"> begin
	N_low = 128
	x_min = 0.0
	x_max = 16π
	
	xs_low = range(x_min, x_max, length=N_low+1)[1:N_low]
	xs_high = range(x_min, x_max, length=5000)[1:end-1]
	f(x) = sin(0.5*x) + cos(x) + cos(2 * x) + sin(0.25*x)
	arr_low = f.(xs_low)
	arr_high = f.(xs_high)
end

begin
	N = 1000
	xs_interp = range(x_min, x_max, length=N+1)[1:N]
	arr_interp = resample(arr_low, N)
end

begin
	scatter(xs_low, arr_low, legend=:bottomleft, markersize=2, label=&quot;Low sampling&quot;)
	plot!(xs_interp, arr_interp, label=&quot;FFT based sinc interpolation&quot;, linestyle=:dash)
	plot!(xs_high, arr_high, linestyle=:dashdotdot, label=&quot;High sampling&quot;)
end</code></pre><p><img src="../assets/1D_resample.png" alt/></p><h2 id="Downsampling"><a class="docs-heading-anchor" href="#Downsampling">Downsampling</a><a id="Downsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Downsampling" title="Permalink"></a></h2><p>32 samples in the downsampled signal should be sufficient for Nyquist sampling. And as we can see, the downsampled signal still matches the original one.</p><pre><code class="language-julia hljs">begin
	N_ds = 32
	xs_ds = range(x_min, x_max, length=N_ds+1)[1:N_ds]
	arr_ds = resample(arr_high, N_ds)
end

begin
	scatter(xs_low, arr_low, legend=:bottomleft, markersize=2, label=&quot;Low sampling&quot;)
	plot!(xs_interp, arr_interp, label=&quot;FFT based sinc interpolation&quot;, linestyle=:dash)
	plot!(xs_ds, arr_ds, label=&quot;resampled array&quot;, linestyle=:dot)	
end</code></pre><p><img src="../assets/plot_ds.png" alt/></p><h2 id="Image-Upsampling"><a class="docs-heading-anchor" href="#Image-Upsampling">Image Upsampling</a><a id="Image-Upsampling-1"></a><a class="docs-heading-anchor-permalink" href="#Image-Upsampling" title="Permalink"></a></h2><p>Having a Nyquist sampled image, it is possible to perform a sinc interpolation and creating visually much nicer images. However, the information content does not change between both images. The full Pluto notebook is <a href="https://github.com/bionanoimaging/FourierTools.jl/tree/main/examples/resample_image.jl">here</a>. The right image is the upsampled version of the left one.</p><p><img src="../assets/image_low_res.png" alt/> <img src="../assets/image_high_res.png" alt/></p><p>There are fast versions (<code>upsample2</code>) for upsampling by a factor of 2.</p><h2 id="Function-References"><a class="docs-heading-anchor" href="#Function-References">Function References</a><a id="Function-References-1"></a><a class="docs-heading-anchor-permalink" href="#Function-References" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="FourierTools.resample" href="#FourierTools.resample"><code>FourierTools.resample</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample(arr, new_size [, normalize=true])</code></pre><p>Calculates the <code>sinc</code> interpolation of an <code>arr</code> on a new array size <code>new_size</code>. It is a re-evaluation of the Fourier series at new grid points. <code>new_size</code> can be arbitrary. Each dimension is then independently either up or downsampled.</p><p>This method is based on FFTs and therefore implicitly assumes periodic boundaries and a finite frequency support.</p><p><code>normalize=true</code> by default multiplies by an appropriate factor so that the array size is included in the scaling. This results in an array having roughly the same mean intensity.</p><p><strong>Basic Principle</strong></p><p>If <code>size(new_size)[i] &gt; size(arr)[i]</code>, we apply zero padding in Fourier space.</p><p>If <code>size(new_size)[i] &lt; size(arr)[i]</code>, we cut out a centered part of the Fourier spectrum.</p><p>We apply some tricks at the boundary to increase accuracy of highest frequencies. </p><p>For real arrays we use <code>rfft</code> based operations, for complex one we use <code>fft</code> based ones.</p><p><strong>Examples</strong></p><p>sinc interpolation of 2 datapoints result in an approximation of cosine.</p><pre><code class="language-julia-repl hljs">julia&gt; resample([2.0, 0.0], (6,))
6-element Vector{Float64}:
 2.0
 1.5
 0.5
 0.0
 0.5
 1.5

julia&gt; resample([2.0, 0.0], (6,)) ≈ 1 .+ cos.(2π .* (0:5)./6)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L10-L54">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.resample_by_FFT" href="#FourierTools.resample_by_FFT"><code>FourierTools.resample_by_FFT</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_by_FFT(mat, new_size)</code></pre><p>Does a resampling based on <code>fft</code>. This function is called by <code>resampling</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L86-L90">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.resample_by_RFFT" href="#FourierTools.resample_by_RFFT"><code>FourierTools.resample_by_RFFT</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_by_RFFT(mat, new_size)</code></pre><p>Does a resampling based on <code>rfft</code>. This function is called by <code>resampling</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L74-L78">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.resample_nfft" href="#FourierTools.resample_nfft"><code>FourierTools.resample_nfft</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_nfft(img, new_pos, dst_size=nothing; pixel_coords=false, is_local_shift=false, is_src_coords=true, reltol=1e-9)</code></pre><p>resamples an ND-array to a set of new positions <code>new_pos</code> measured in either in pixels (<code>pixel_coords=true</code>)  or relative (Fourier-) image coordinates (<code>pixel_coords=false</code>). <code>new_pos</code> can be </p><ul><li>an array of <code>Tuples</code> specifying the zoom along each direction</li><li>an <code>N+1</code> dimensional array (for <code>N</code>-dimensional input data <code>img</code>) of destination positions, the last dimension  enumerating the respective destination coordinate dimension.</li><li>a function accepting a coordinate <code>Tuple</code> and yielding a destination position <code>Tuple</code>.</li></ul><p><code>resample_nfft</code> can perform a large range of possible resamplings. Note that the default setting is <code>is_src_coords=true</code>  which means that the source coordinates of each destination position have to be specified. This has the advantage that  the result has usually less artefacts, but the positions may be more less convenient to specify.</p><p><strong>Arguments</strong></p><ul><li><code>img</code>: the image to apply resampling to</li><li><code>new_pos</code>`: specifies the resampling. See description above.</li><li><code>dst_size</code>: this argument optionally defines the output size. If you require a different result size              for <code>new_pos</code> being a function or with <code>is_src_coords=true</code>, state it here. By default (<code>dst_size=nothing</code>) the              destination size will be inferred form the argument <code>new_pos</code> or assumed to be <code>size(img)</code>.</li><li><code>is_local_shift</code>: specifies, whether the resampling coordinates refer to a relative shift or absoluter coordinates</li><li><code>is_in_pixels</code>: specifies whether the coordinates (or relative distances) are given in pixel pitch units (<code>is_in_pixels=true</code>) or in units relative to the array sizes (Fourier convention) </li><li><code>is_src_coords</code>: specifies, whether the resampling positions refer to sampling at source (<code>is_src_coords=true</code>) or destination coordinates </li><li><code>reltol</code>: will be used as an argument to the <code>nfft</code> function spedifying the relative precision to calculate to</li></ul><p>See also: <code>resample</code>, <code>resample_czt</code></p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using FourierTools, TestImages, NDTools, View5D, IndexFunArrays

julia&gt; a = Float32.(testimage(&quot;resolution&quot;));

julia&gt; b = resample_nfft(a, t -&gt; (2.5f0 *sign(t[1])*t[1]^2, t[2]*(0.5f0+t[1]))); # a complicated deformation

julia&gt; sz = size(a);

# stacking only the displacement along the last dimension:
julia&gt; new_pos = cat(xx(sz,scale=ScaFT), zeros(sz), dims=3);

julia&gt; c = resample_nfft(a, new_pos, is_local_shift=true); # stretch along x using an array

julia&gt; new_pos = cat(.-xx(sz,scale=ScaFT)./2, zeros(sz), dims=3);

julia&gt; c2 = resample_nfft(a, new_pos, is_local_shift=true, is_src_coords=false); # stretch along x using an array

# Notice the difference in brightness between c and c2
julia&gt; @ve a b c c2 # visualize distortion and x-shrinks. 

# Lets try a 2D rotation:
# define a rotation operation
julia&gt; rot_alpha(a, t) = (cosd(a)*t[1] + sind(a)*t[2], -sind(a)*t[1]+cosd(a)*t[2])

# positions as an array of tuples
julia&gt; new_pos = rot_alpha.(10.0, idx(a, scale=ScaFT))

# lets do the resampling, this time by specifying the destination coordinates:
julia&gt; d = resample_nfft(a, new_pos, is_src_coords=false);

#display the result
julia&gt; @ve a d

#how about a spiral deformation?
julia&gt; new_pos = rot_alpha.(rr(a), idx(a, scale=ScaFT))

julia&gt; e = resample_nfft(a, new_pos);

julia&gt; f = resample_nfft(a, new_pos, is_src_coords=false);

# observe the artefacts generated by undersampling in the destination grid
julia&gt; @ve a e f</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L318-L390">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.resample_czt" href="#FourierTools.resample_czt"><code>FourierTools.resample_czt</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">resample_czt(arr, rel_zoom; shear=nothing, shear_dim=nothing, fix_nyquist=false, new_size = size(arr), 
             do_damp=false, rel_pad=0.2, remove_wrap=true)</code></pre><p>resamples the image with fixed factors or a list of separable functions using the chirp z transform algorithm. The data is first padded by a relative amount <code>rel_pad</code> which is needed to avoid wrap-around problems. As opposed to <code>resample()</code>, this routine allows for arbitrary non-integer zoom factors. It is reasonably fast but only allows a stretch (via <code>rel_zoom</code>) and a shift (via <code>shear</code> in pixels) per line or column.</p><p>Note that each entry of the tuple in <code>rel_zoom</code> or <code>shear</code> describes the zoom or shear to apply to all other dimensions individually per entry along this dimension number. </p><p><strong>Arguments:</strong></p><ul><li><code>arr</code>: array to resample</li><li><code>rel_zoom</code>: factors to zoom as a tuple or a tuple of functions defining the zooms</li><li><code>shear</code>: a tuple of shears or a tuple of shear functions defining the shears</li><li><code>shear_dim</code>: which dimension to shear</li><li><code>fix_nyquist</code>: defines whether to apply <code>fix_nyquist</code> when using the apply<em>shift</em>strength! function.</li><li><code>do_damp</code>: applies a padding and damping outside the region  to zoom, to avoid artefacts</li><li><code>rel_pad</code>: amount of padding to apply, if <code>do_damp</code> is true</li><li><code>remove_wrap</code>: removes the wrap-around when zooming out.</li><li><code>new_size</code>: size of the result array. If not provided the same as the input size will be used.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using TestImages, NDTools, View5D

julia&gt; a = Float32.(testimage(&quot;resolution&quot;));

julia&gt; b = resample_czt(a, (0.99,1.3)); # just zooming and shrinking

julia&gt; c = resample_czt(a, (x-&gt;0.8+x^2/3,x-&gt;1.0+0.2*x)); # a more complicated distortion

julia&gt; d = resample_czt(a, (x-&gt;1.0,x-&gt;1.0), shear=(x-&gt;50*x^2,0.0)); # a more complicated distortion

julia&gt; @ve a,b,c,d # visualize distortions</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L168-L205">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.upsample2" href="#FourierTools.upsample2"><code>FourierTools.upsample2</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">upsample2(mat::AbstractArray{T, N}; dims=1:N, fix_center=false, keep_singleton=false)</code></pre><p>Upsamples by a factor of two in all dimensions.  The code is optimized for speed by using subpixelshifts rather than Fourier resizing. By default the first pixel maintains its position. However, this leads to a shift of the center (size[d]÷2+1) in the resulting array for  uneven array sizes. <code>fix_center=true</code> can be used to remedy this and the result array center position will agree to the source array center position. <code>keep_singleton=true</code> will not upsample dimensions of size one. Note that upsample2 is based on Fourier-shifting and you may have to deal with wrap-around problems.</p><pre><code class="language-julia-repl hljs">julia&gt; upsample2(collect(collect(1.0:9.0)&#39;))
2×18 Matrix{Float64}:
 1.0  0.24123  2.0  3.24123  3.0  2.93582  4.0  5.0  5.0  5.0  6.0  7.06418  7.0  6.75877  8.0  9.75877  9.0  5.0
 1.0  0.24123  2.0  3.24123  3.0  2.93582  4.0  5.0  5.0  5.0  6.0  7.06418  7.0  6.75877  8.0  9.75877  9.0  5.0

julia&gt; upsample2(collect(collect(1.0:9.0)&#39;); fix_center=true, keep_singleton=true)
1×18 Matrix{Float64}:
 5.0  1.0  0.24123  2.0  3.24123  3.0  2.93582  4.0  5.0  5.0  5.0  6.0  7.06418  7.0  6.75877  8.0  9.75877  9.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L130-L150">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.upsample2_abs2" href="#FourierTools.upsample2_abs2"><code>FourierTools.upsample2_abs2</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">upsample2_abs2(mat::AbstractArray{T, N}; dims=1:N)</code></pre><p>Upsamples by a factor of two and applies the abs2 operation. The code is optimized for speed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L159-L163">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="FourierTools.barrel_pin" href="#FourierTools.barrel_pin"><code>FourierTools.barrel_pin</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">barrel_pin(arr, rel=0.5)</code></pre><p>emulates a barrel (<code>rel&gt;0</code>) or a pincushion (<code>rel&lt;0</code>) distortion. The distortions are calculated  using <code>resample_czt()</code> with separable quadratic zooms.</p><p>See also: <code>resample_czt()</code></p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using TestImages, NDTools, View5D

julia&gt; a = Float32.(testimage(&quot;resolution&quot;))

julia&gt; b = barrel_pin(a,0.5) # strong barrel distortion

julia&gt; c = barrel_pin(a,-0.5) # strong pin-cushion distortion

julia&gt; @ve a,b,c # visualize distortions</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/bionanoimaging/FourierTools.jl/blob/322a1e8c3228cae030ae9e13bf33c63350cf9289/src/resampling.jl#L291-L310">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../convolutions/">« FFT Based Convolutions and Cross-Correlation</a><a class="docs-footer-nextpage" href="../shifting/">Shifting with FFTs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 20 June 2024 12:51">Thursday 20 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
